#!/usr/bin/env python3
# -*- coding: utf-8 -*-
import sys
import os
import tempfile
import subprocess


# See <https://stackoverflow.com/questions/4856583/
#   how-do-i-pipe-a-subprocess-call-to-a-text-file>

tmp_path = tempfile.mktemp(prefix="ogrep")
long_forms = {}
long_forms["-n"] = ["--line-number", "--line-buffered"]
long_forms["-H"] = ["--with-filename"]
always_use = ["-n", "-H"]  # add line number to grep output
args = []
used_singles = []

for i in range(1, len(sys.argv)):
    args.append(sys.argv[i])

# Collect short versions of long options used:
for i in range(1, len(sys.argv)):
    for k, options in long_forms.items():
        for option in options:
            if sys.argv[i] == option:
                if sys.argv[i] not in used_singles:
                    used_singles.append(k)

for arg in always_use:
    if (arg not in args) and (arg not in used_singles):
        args.append(arg)

with open(tmp_path, 'w') as outs:
    subprocess.call(["grep"] + args, stdout=outs)
    # For a cross-platform way to find the executable, see
    # (unused) <https://gist.github.com/techtonik/4368898>

subprocess.call(["outputinspector", tmp_path])

if os.path.isfile(tmp_path):
    os.remove(tmp_path)
